<!-- TOC -->

- [1. 异常与调试](#1-异常与调试)
- [2. 异常的流程](#2-异常的流程)
- [3. 异常的类别](#3-异常的类别)
- [4. 异常记录](#4-异常记录)
    - [4.1. CPU异常](#41-cpu异常)
    - [4.2. 模拟异常](#42-模拟异常)

<!-- /TOC -->
# 1. 异常与调试
异常与调试是紧密相连的，异常是调试的基础。软件调试、反调试、调试器都与异常息息相关。
# 2. 异常的流程
异常产生后，首先要记录异常信息（异常类型、异常发生的位置等），然后进行异常分发（寻找异常的处理函数）和异常处理（调用异常处理函数）。
# 3. 异常的类别
* CPU异常，由CPU产生、发现的异常
* 模拟异常，由软件模拟产生，如throw、raise语句
# 4. 异常记录
```mermaid
graph TD;
A-->B;
A-->C;
B-->D;
C-->D;
```
## 4.1. CPU异常
CPU检测到异常，然后查IDT表，执行中断处理函数，中断处理函数在保存现场之后，会调用CommonDispatchException（在堆栈上构造一个结构体_EXCEPTION_RECORD，并存放异常信息），然后调用KiDispatchException（分发异常，找到合适的异常处理函数）。
## 4.2. 模拟异常
流程，高级语言初始函数不同，raiseexception。软件模拟异常的errorcode固定，依赖编译环境。address也是固定的，为raiseexception函数地址。Kiraiseexception